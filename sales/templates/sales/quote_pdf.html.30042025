<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Devis {{ quote.number }}</title>
    <style>
        /* Styles de base pour le PDF */
        body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            font-size: 11pt;
            line-height: 1.4;
            color: #333;
            margin: 0;
            padding: 0;
        }
        .container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }
        .header {
            margin-bottom: 30px;
            border-bottom: 2px solid #2c3e50;
            padding-bottom: 20px;
        }
        .header .logo {
            font-size: 22pt;
            font-weight: bold;
            color: #2c3e50;
        }
        .header-info {
            display: flex;
            justify-content: space-between;
        }
        .company-info {
            width: 60%;
        }
        .document-info {
            width: 40%;
            text-align: right;
        }
        .company-info p, .document-info p {
            margin: 3px 0;
        }
        .document-title {
            font-size: 18pt;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }
        .client-info {
            margin-bottom: 30px;
            border: 1px solid #eee;
            padding: 15px;
            background-color: #f9f9f9;
        }
        .items-table {
            width: 100%;
            margin-bottom: 30px;
            border-collapse: collapse;
        }
        .items-table th {
            background-color: #2c3e50;
            color: white;
            padding: 8px;
            text-align: left;
        }
        .items-table td {
            padding: 8px;
            border-bottom: 1px solid #ddd;
        }
        .items-table tfoot {
            font-weight: bold;
        }
        .items-table tfoot td {
            border-top: 2px solid #2c3e50;
        }
        .subtotals {
            text-align: right;
            margin-bottom: 30px;
        }
        .total {
            margin-top: 10px;
            font-size: 14pt;
            font-weight: bold;
            color: #2c3e50;
        }
        .terms {
            margin-top: 40px;
            border-top: 1px solid #ddd;
            padding-top: 20px;
        }
        .validity {
            margin-top: 20px;
            font-style: italic;
        }
        .footer {
            margin-top: 50px;
            font-size: 9pt;
            color: #777;
            text-align: center;
            border-top: 1px solid #ddd;
            padding-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-info">
                <div class="company-info">
                    <div class="logo">ECINTELLIGENCE</div>
                    <p>{{ company_info.address }}</p>
                    <p>{{ company_info.city }} - {{ company_info.country }}</p>
                    <p>{{ company_info.email }} | {{ company_info.phone }}</p>
                    <p>RC {{ company_info.rc }} - IF {{ company_info.if_number }} - Patente {{ company_info.patente }} - ICE {{ company_info.ice }}</p>
                </div>
                <div class="document-info">
                    <p><strong>Devis N°:</strong> {{ quote.number }}</p>
                    <p><strong>Date:</strong> {{ quote.issue_date|date:"d/m/Y" }}</p>
                    <p><strong>Validité:</strong> {{ quote.expiration_date|date:"d/m/Y" }}</p>
                    <p><strong>Référence:</strong> {% if quote.opportunity %}{{ quote.opportunity.name }}{% else %}---{% endif %}</p>
                    <p><strong>Devise:</strong> {{ quote.currency.code }}</p>
                </div>
            </div>
        </div>
        
        <div class="document-title">DEVIS</div>
        
        <div class="client-info">
            <h3>Client</h3>
            <p><strong>{{ company.name }}</strong></p>
            <p>{% if company.address_line1 %}{{ company.address_line1 }}{% endif %}
               {% if company.address_line2 %}<br>{{ company.address_line2 }}{% endif %}</p>
            <p>{% if company.city %}{{ company.city }}{% endif %}{% if company.postal_code %}, {{ company.postal_code }}{% endif %}
               {% if company.country %} - {{ company.country }}{% endif %}</p>
            <p>Contact: {{ contact.first_name }} {{ contact.last_name }}{% if contact.title %} ({{ contact.title }}){% endif %}</p>
            <p>{% if contact.email %}Email: {{ contact.email }}{% endif %}
               {% if contact.phone %} | Tél: {{ contact.phone }}{% endif %}</p>
        </div>
        
        <table class="items-table">
            <thead>
                <tr>
                    <th>Référence</th>
                    <th>Description</th>
                    <th>Quantité</th>
                    <th>Prix unitaire</th>
                    <th>TVA (%)</th>
                    <th>Total HT</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr>
                    <td>{{ item.product.reference }}</td>
                    <td>
                        <strong>{{ item.product.name }}</strong>
                        {% if item.description %}<br>{{ item.description }}{% endif %}
                    </td>
                    <td>{{ item.quantity }}</td>
                    <td>{{ item.unit_price }} {{ quote.currency.code }}</td>
                    <td>{{ item.tax_rate }}%</td>
                    <td>{{ item.subtotal }} {{ quote.currency.code }}</td>
                </tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="4"></td>
                    <td>Sous-total:</td>
                    <td>{{ quote.subtotal }} {{ quote.currency.code }}</td>
                </tr>
                <tr>
                    <td colspan="4"></td>
                    <td>TVA:</td>
                    <td>{{ quote.tax_amount }} {{ quote.currency.code }}</td>
                </tr>
                <tr>
                    <td colspan="4"></td>
                    <td>Total TTC:</td>
                    <td>{{ quote.total }} {{ quote.currency.code }}</td>
                </tr>
            </tfoot>
        </table>
        
        {% if quote.bank_account %}
        <div class="bank-info">
            <h3>Coordonnées bancaires</h3>
            <p><strong>Banque:</strong> {{ quote.bank_account.bank_name }}</p>
            <p><strong>RIB:</strong> {{ quote.bank_account.rib }}</p>
            {% if quote.bank_account.iban %}<p><strong>IBAN:</strong> {{ quote.bank_account.iban }}</p>{% endif %}
            {% if quote.bank_account.swift %}<p><strong>SWIFT:</strong> {{ quote.bank_account.swift }}</p>{% endif %}
        </div>
        {% endif %}
        
        {% if quote.notes %}
        <div class="notes">
            <h3>Notes</h3>
            <p>{{ quote.notes }}</p>
        </div>
        {% endif %}
        
        <div class="terms">
            <h3>Conditions</h3>
            {% if quote.terms %}
                <p>{{ quote.terms }}</p>
            {% else %}
                <p>- Ce devis est valable jusqu'au {{ quote.expiration_date|date:"d/m/Y" }} (20 jours ouvrés).</p>
                <p>- Le paiement devra être effectué selon les conditions convenues.</p>
                <p>- Toute modification de ce devis fera l'objet d'un nouveau document.</p>
            {% endif %}
        </div>
        
        <div class="validity">
            <p>Ce devis est valable jusqu'au {{ quote.expiration_date|date:"d/m/Y" }}.</p>
        </div>
        
        <div class="footer">
            <p>Document généré le {{ generated_at|date:"d/m/Y à H:i" }}</p>
            <p>ECINTELLIGENCE - Experts Computing Intelligence</p>
        </div>
    </div>
</body>
</html>
